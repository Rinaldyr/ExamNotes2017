<!DOCTYPE html>
<html lang="en">
<head>
    <!--[if lt IE 9]>
    <script> document.createElement("keyword"); </script>
    <![endif]-->

    <meta charset="UTF-8">
    <title> Introductory Databases </title>
    <link href="images/icon.png" rel="icon"/>
    <style type="text/css">
        body {
            background-color: #dbffe0;
            font-family: "Georgia", serif;
            margin: 20px;
        }

        pre {
            font-family: Consolas, monospace;
            color: #7a2a95;
        }

        code {
            font-family: Consolas, monospace;
            color: #7a2a95;
        }

        keyword {
            color: #a90001;
            font-weight: bold;
        }

        code.type {
            color: #4913d3;
            font-weight: bold;
        }

        #topBtn {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 99;
            border: none;
            outline: none;
            background-color: red;
            color: white;
            cursor: pointer;
            padding: 15px;
            border-radius: 10px;
        }

        #topBtn:hover {
            background-color: #555;
            opacity: 0.3;
        }

        #homeBtn {
            display: block;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 99;
            border: none;
            outline: none;
            background-color: red;
            color: white;
            cursor: pointer;
            padding: 15px;
            border-radius: 10px;
        }

        #homeBtn:hover {
            background-color: #555;
            opacity: 0.3;
        }
    </style>
</head>
<body>
<hr/> <!------------------------------------------------------------------------------->
<h1> LI Introductory Databases </h1>
<hr/> <!------------------------------------------------------------------------------->
Table of Contents
<ol>
    <li><a href="#intro"> Introduction </a></li>
    <li><a href="#database"> Database </a><ul>
        <li><a href="#database1"> Relational Database </a></li>
    </ul></li>
    <li><a href="#basics"> Basics </a><ul>
        <li><a href="#basics1"> Sets </a></li>
        <li><a href="#basics2"> Keys </a></li>
        <li><a href="#basics3"> SQL </a></li>
    </ul></li>
    <li><a href="#constraints"> Constraints </a><ul>
        <li><a href="#constraints1"> Primary Key </a></li>
        <li><a href="#constraints2"> Foreign Key </a></li>
    </ul></li>
    <li><a href="#joins"> Joins </a><ul>
        <li><a href="#joins1"> Join Variations </a></li>
        <li><a href="#joins2"> Set Operations </a></li>
        <li><a href="#joins3"> Subqueries </a></li>
        <li><a href="#joins4"> Groups </a></li>
        <li><a href="#joins5"> Views </a></li>
    </ul></li>
    <li><a href="#jdbc"> Java Database Connection (JDBC) </a><ul>
        <li><a href="#jdbc1"> Using JDBC </a></li>
        <li><a href="#jdbc2"> Transactions </a></li>
    </ul></li>
    <li><a href="#design"> Database Designs </a><ul>
        <li><a href="#design1"> Design with Entity Relationship (ER) </a></li>
        <li><a href="#design2"> Mapping from ER to DB </a></li>
    </ul></li>
    <li><a href="#webapps"> Web Applications </a></li>
    <li><a href="#jsp"> Java Server Pages (JSP) </a></li>
    <li><a href="#session"> Session Tracking </a></li>
    <li><a href="#normalisation"> Database Normalisation </a></li>
    <li><a href="#papers"> Exam Paper </a></li>
</ol>
<hr/> <!------------------------------------------------------------------------------->

<h2 id="intro"> 1 &dash; Introduction </h2>
<p> As the world we are living in today gets more connected, we start to question how to <keyword>store</keyword> and <keyword>share</keyword> data. Data can be stored in many ways, for instance by memory, written documents, computer Java objects, XML data files, and so on. Data can also be shared through again, memory, sharing files locally in computers, having a document repository, or even data servers. </p>

<p> All of these have their applications, but what if we need something that <keyword>integrates</keyword> with existing systems? <br/> This is where <keyword>databases</keyword> comes in. </p>

<p> We will be using <a href="https://www.postgresql.org/"> PostgreSQL</a> for this module.</p>

<hr/> <!------------------------------------------------------------------------------->

<h2 id="database"> 2 &dash; Database </h2>
<p> <keyword> Database </keyword> is a structured set of data held in a computer, especially one that is accessible in various ways. </p>
<p> Database management system (DBMS) is a core data base, which is a representation of data that can be used for retrieval and maintenance. </p>
<p> There are many database models, but <keyword> relational databases </keyword> are the pre-eminent choice for general purpose of database systems. </p>

<p> In a database, we want an organised collection of data, also with some desirable properties such as the ACID below. </p>
<p><strong> ACID </strong></p>
<ul>
    <li> <keyword>Atomicity</keyword> &dash; a transaction happens as a whole, or not at all. </li>
    <li> <keyword>Consistency</keyword> &dash; a DB is always in a consistent state. </li>
    <li> <keyword>Isolation</keyword> &dash; the effect of two operations happening in parallel is the same as if they had happened sequentially. </li>
    <li> <keyword>Durability</keyword> &dash; once something is stored it won't disappear. </li>
</ul>

<h3 id="database1"> Relational Database </h3>
<p> This is the main model for database systems. Data is structured in the form of <keyword>set</keyword> and <keyword>relations</keyword>, and is connected using <keyword>basic set theory</keyword>. They are viewed as <keyword>tables</keyword>. Queries specify result and <strong>not</strong> how it is computed. </p>

<p> A <keyword>query</keyword> in database is an statement that specifies a request for information from the database. This will be explored more later on. </p>

<hr/> <!------------------------------------------------------------------------------->

<h2 id="basics"> 3 &dash; Basics </h2>
<p> Relational databases uses the set theory to connect data around. </p>
<h3 id="basics1"> 3.1 &ndash; Sets </h3>
<p><strong>Sets</strong> are collections of items. They are unordered and do not contain duplicates. They are written as: <code>{2,4,6,8}</code>.</p>

<p> Items inside a set are called <em>elements</em>. <br/> If all the elements of a set are also elements of a second set then the first set is a <em>subset</em> of the second, and the second a <em>superset</em> of the first. <br/> If the second set has extra elements then the first is a <em>proper subset</em> of the second. </p>

<p> Set definitions </p>
<ul>
    <li><keyword>Union &Union;</keyword> of two sets is a set made up of <strong>all</strong> elements of the two sets. </li>
    <li><keyword>Intersection &Intersection;</keyword> between two sets is the set whose elements are in <strong>both</strong> operand sets. </li>
    <li><keyword>Difference /</keyword> between the first the second set is the set whose elements are in the first but not in the second. </li>
    <li><keyword>Empty Set <code>{}</code></keyword> is a set <strong>without</strong> any elements.</li>
</ul>

<p> Relational Definitions </p>
<ul>
    <li><keyword>Domain</keyword> is a non-empty arbitrary set of atomic values.</li>
    <li><keyword>Attribute name</keyword> is a symbol with an associated domain.</li>
    <li><keyword>Relational Schema</keyword> is a finite set of attribute names.</li>
    <li><keyword>Tuple</keyword> of a relational schema is a mapping from the attributes of a relational schema the union of their domains. </li>
    <li><keyword>Relation</keyword> of a relationship schema is a finite set of tuples of a relational schema.</li>
    <li><keyword>Degree or Arity</keyword> of a relationship schema is the number of attributes.</li>
    <li><keyword>Cardinality</keyword> of a relation is the number of tuples or elements in a set. </li>
</ul>

<h3 id="basics2"> 3.2 &ndash; Keys </h3>
<p> Keys are used to establish and identify relation between tables. They also ensure that each record within a table can be uniquely identified by combination of one or more fields within a table. </p>
<ul>
    <li><keyword>Super Key</keyword> &ndash; a set of attributes that can <em>always</em> be used to differentiate one tuple from another.</li>
    <li><keyword>Candidate Key</keyword> &ndash; is a subset of a <keyword>Super Key</keyword>. A candidate key is a single field or the least combination of fields that uniquely identifies each record in the table. Every table must have at least one candidate key but at the same time can have several. </li>
    <li><keyword>Concatenated Key</keyword> &ndash; a key with more than one attribute.</li>
    <li><keyword>Primary Key</keyword> &ndash; a candidate key that uniquely identify each record in a table.</li>
    <li><keyword>Foreign Key</keyword> &ndash; a key that points to primary key attributes.</li>
</ul>

<h3 id="basics3"> 3.3 &ndash; Standard Query Language (SQL) </h3>
<p> SQL provides the mechanism that is used to manipulate a relational database. The <keyword>Data Definition Language </keyword> (DDL) is used to create, modify and delete parts of the <em>definition</em> of the database. The <keyword>Data Manipulation Language</keyword> (DML) is used to <em>manipulate the data</em>. </p>
<p> In SQL, case and whitespaces are not significant, but there are conventions that is good to follow:</p>
<ul>
    <li> SQL keywords in <strong>upper case</strong>.</li>
    <li> Table names capitalised.</li>
    <li> Field names lower case. </li>
    <li> Layout. </li>
</ul>

<h4> CREATE </h4>
<p><code> CREATE TABLE Name { <br/> &emsp; field1 type1, <br/> &emsp; field2 type2, <br/> &emsp; constraints <br/>} </code></p>
<p> This creates a table with the name, its fields inside the curly braces, and addition of constraints are possible too.</p>
<p> Constraints on the data should be included on one field or across several. </p>
<ul>
    <li><code>NOT NULL</code></li>
    <li><code>UNIQUE</code></li>
</ul>

<h4> DROP </h4>
<p><code> DROP TABLE Name </code></p>
<p> This deletes the table called Name. Don't just go around dropping everything now!</p>

<h4> ALTER </h4>
<p><code> ALTER TABLE Name ADD COLUMN field type </code></p>
<p> This modifies the table definition by adding nulls to the table. </p>

<p> Drop and alter can be applied to other things as well. </p>

<p> Databases are business critical so it may not be possible to rebuild them. They could be live for a very long time, so we update them 'on the fly'. </p>

<p> Some Types </p>
<ul>
    <li> <code class="type">BOOLEAN</code> &dash; TRUE, FALSE, or NULL </li>
    <li> <code class="type">CHAR(size)</code> or <code class="type">CHARACTER(size)</code> &dash; characters </li>
    <li> <code class="type">VARCHAR</code> &dash; strings </li>
    <li> <code class="type">INT</code> or <code class="type">INTEGER</code></li>
    <li> <code class="type">REAL, FLOAT</code> or <code class="type">DOUBLE</code></li>
    <li> <code class="type">NUMERIC</code> or <code class="type">DECIMAL</code></li>
    <li> <code class="type">DATE</code> &dash; date types </li>
    <li> <code class="type">TIME</code> &dash; a type of day value </li>
</ul>

<hr/> <!------------------------------------------------------------------------------->

<h2 id="constraints"> 4 &ndash; Constraints </h2>
<p> <keyword>Constraints</keyword> place restrictions on the values that can be inserted into the database. They are <strong>hard</strong> constraints that the DBMS will check and enforce them. <br/> They are metadata used to: </p>
<ul>
    <li> Make <keyword>explicit domain</keyword> constraints. </li>
    <li> Maintain the <keyword>integrity</keyword> of the database. </li>
</ul>
<p> If these constraints are <keyword>violated</keyword>, then the operation fails. </p>

<h3 id="constraints1"> 4.1 &ndash; Primary Key </h3>
<p><code> PRIMARY KEY(field) </code> or <code>CONSTRAINT constraintName PRIMARY KEY(field)</code></p>
<p> A <keyword>primary key constraint</keyword> enforces <code>UNIQUE</code> and <code>NOT NULL</code>.</p>
<p> Example: </p>
<p><code>CREATE TABLE Student {<br/> &emsp; id INT, <br/> &emsp; name VARCHAR, <br/> &emsp; PRIMARY KEY (id) <br/>}</code> </p>
<p> or by naming the constraint </p>
<p><code>CREATE TABLE Student {<br/> &emsp; id INT, <br/> &emsp; name VARCHAR, <br/> &emsp; CONSTRAINT IDKey PRIMARY KEY (id) <br/>}</code> </p>

<h3 id="constraints2"> 4.2 &ndash; Foreign Key </h3>
<p><code> FOREIGN KEY (field) REFERENCES Table(field) </code></p>
<p> A <keyword>foreign key</keyword> defines a link (usually to a <keyword>primary key</keyword>) to another table</p>
<p> This <em>isn't</em> checked on insertion because it is <strong>guaranteed</strong> to be true. </p>
<p> Example: </p>
<p><code>CREATE TABLE Marks {<br/> &emsp; id INT, <br/> &emsp; mark INT, <br/> &emsp; FOREIGN KEY (id) REFERENCES Student(id) <br/>}</code> </p>

<p> The integrity of the database is maintained by: </p>
<ul>
    <li> <keyword>Forbidding</keyword> the operation <ul>
        <li> RESTRICT &ndash; is done before the operation </li>
        <li> NO ACTION &ndash; by <em>default</em>, is done after </li>
    </ul></li>
    <li> Delete rows that <keyword>reference</keyword> the deleted key (ON DELETE CASCADE) </li>
</ul>

<p> Note that constraints specified in the 'child' table can affect operations on both the 'child' and 'parent' tables. </p>

<p> We can also enforce additional constraints over <keyword>values</keyword>. </p>
<p> Example: </p>
<p> <code>CHECK(age >= 0 AND age <= 120)</code></p>

<hr/> <!------------------------------------------------------------------------------->

<h2 id="sql"> 5 &ndash; Data Manipulation and Query </h2>
<h3 id="sql1"> 5.1 &ndash; Data Manipulation </h3>
<ul>
    <li> INSERT <ul>
        <li> <keyword>Inserts</keyword> data into a table. </li>
        <li><code> INSERT INTO Table VALUES (data1, data2); </code></li>
        <li><code> INSERT INTO Student (id, name) VALUES (4, 'John Doe'); </code></li>
    </ul> </li>

    <li> UPDATE <ul>
        <li> <keyword>Modify</keyword> values in rows. </li>
        <li> Specify table <strong>rows</strong> and <strong>attributes</strong> and their <em>new</em> values. </li>
        <li><code> UPDATE Table SET field='data'; </code></li>
        <li><code> UPDATE Student SET course='CS' WHERE id=23; </code></li>
        <li> If code meet conditions, then data will be updated. </li>
    </ul> </li>

    <li> DELETE <ul>
        <li> <keyword>Deletes</keyword> rows from the table. </li>
        <li><code> DELETE FROM Table WHERE field=data; </code></li>
        <li><code> DELETE FROM Student WHERE id=4; </code></li>
        <li> Rows that meet the conditions will be deleted. </li>
    </ul></li>
</ul>
<p> All these commands are subject to <keyword>constraint checking</keyword>. </p>

<h3 id="sql2"> 5.2 &ndash; Data Query </h3>
<ul>
    <li> SELECT <ul>
        <li> To <keyword>retrieve</keyword> data from tables: <ul>
            <li> One or more combining data from <strong>several tables</strong>. </li>
            <li> Result is a <strong>table</strong>. </li>
        </ul></li>
        <li><code> SELECT * FROM Table; </code></li>
        <li><code> SELECT name FROM Student WHERE id=4; </code></li>
        <li><code> SELECT Student.name, Student.id FROM Student WHERE Student.course='CS'; </code></li>
    </ul></li>

    <li> DISTINCT <ul>
        <li> <keyword>Remove duplicate</keyword> rows</li>
        <li><code> SELECT DISTINCT course From Student; </code></li>
    </ul></li>

    <li> AS <ul>
        <li> Attaches a <keyword>label</keyword> to a column. </li>
    </ul></li>

    <li> ORDER BY <ul>
        <li> Allows the <keyword>order</keyword> of rows to be specified </li>
        <li> ASC/DESC </li>
        <li><code> SELECT FROM * Students ORDER BY name ASC; </code></li>
    </ul></li>
    <li> And many more... </li>
</ul>

<h3 id="sql3"> 5.3 &ndash; Retrieval Criteria </h3>
<ul>
    <li> WHERE <ul>
        <li> Selection criteria that can involve arbitrarily complex expressions. <ul>
            <li> AND </li>
            <li> OR </li>
            <li> Comparison Operators &lt;, &le;, &gt;, &ge;. </li>
            <li> IS [NOT] NULL </li>
            <li> IS [NOT] TRUE </li>
            <li> [NOT] IN </li>
            <li> [NOT] BETWEEN <ul>
                <li><code> Age BETWEEN 18 AND 65 </code></li>
            </ul></li>
        </ul></li>
    </ul></li>

    <li> LIKE <ul>
        <li> Provides <keyword>pattern matching</keyword> on <strong>strings</strong>.</li>
        <li><code>_</code> &ndash; matches <strong>any</strong> character </li>
        <li><code>%</code> &ndash; matches <strong>0</strong> or <strong>more</strong> characters </li>
        <li><code> Name LIKE '_ob%' </code></li>
    </ul></li>
</ul>

<hr/> <!------------------------------------------------------------------------------->

<h2 id="joins"> 6 &ndash; Joins </h2>
<h3 id="joins1"> 6.1 &ndash; Join Variations </h3>
<p> <keyword>Join</keyword> returns a table specified in the query. This can be a <em>substitute</em> for WHERE. </p>
<p> For example, </p>
<img src="images/database/joins1.JPG"/>
<p id="name"> If there are any <em>ambiguity</em> in a field name, then the table name should be included too. </p>
<p><code> SELECT S.id, M.id FROM Student S, Marks M WHERE S.id = M.id </code></p>
<p> Joins are conceptually: </p>
<ul>
    <li> Form <keyword>cross product</keyword> of the set of tables. </li>
    <li> <keyword>Select columns</keyword> listed in the SELECT. </li>
    <li> <keyword>Select rows</keyword> that meet any WHERE condition. </li>
</ul>
<ul>
    <li style="padding-bottom: 20px"> INNER JOIN <ul>
        <li> Produces only the set of records that <keyword>match in both tables</keyword>. </li>
        <li><code> SELECT * FROM TableA <br/> <strong>INNER JOIN</strong> TableB <br/> ON TableA.field=TableB.field; </code> <br/> <img src="images/database/joins2.png"/>
    </ul></li>

    <li style="padding-bottom: 20px"> FULL OUTER JOIN <ul>
        <li> Produces the set of <keyword>all records</keyword> in TableA and TableB , matching records from both sides where available. </li>
        <li> If there is <keyword>no match</keyword>, the missing side wil contain <strong>null</strong>. </li>
        <li><code> SELECT * FROM TableA <br/> <strong>FULL OUTER JOIN</strong> TableB <br/> ON TableA.field=TableB.field; </code> <br/> <img src="images/database/joins3.png"/>
    </ul></li>

    <li> FULL OUTER JOIN<em>* extra</em> <ul>
        <li> Produces the set of records <keyword>without intersection</keyword> from both tables. </li>
        <li><code> SELECT * FROM TableA <br/> FULL OUTER JOIN <br/> TableB <br/> ON TableA.field=TableB.field <br/> <strong> WHERE TableA.id IS null <br/> OR TableB.id IS null</strong>; </code> <br/> <img src="images/database/joins6.png"/>
    </ul></li>

    <li style="padding-bottom: 20px"> LEFT JOIN <ul>
        <li> Just like INNER JOIN but: <ul>
            <li> Includes rows in the <keyword>left table</keyword> that are not matched. </li>
            <li> <strong>null</strong>s are added. </li>
        </ul></li>
        <li><code> SELECT * FROM TableA <br/> <strong>LEFT JOIN</strong> TableB <br/> ON TableA.field=TableB.field; </code> <br/> <img src="images/database/joins4.png"/>
    </ul></li>

    <li style="padding-bottom: 20px"> LEFT OUTER JOIN<em>*</em> <ul>
        <li> Produces a complete set of records from TableA but not in TableB. </li>
        <li><code> SELECT * FROM TableA <br/> LEFT OUTER JOIN TableB <br/> ON TableA.field = TableB.field <br/> <strong>WHERE TableA.id IS null</strong>;</code> <br/> <img src="images/database/joins5.png"/>
    </ul></li>

    <li style="padding-bottom: 20px"> RIGHT JOIN <ul>
        <li> Just the same like LEFT JOIN, but focuses on the <keyword>right table</keyword>. </li>
    </ul></li>

    <li style="padding-bottom: 20px"> EQUI JOIN <ul>
        <li> Just INNER Join where the condition only includes <keyword>equality</keyword>. </li>
    </ul></li>

    <li style="padding-bottom: 20px"> NATURAL JOIN <ul>
        <li> Equality test is implicit based on the names of attributes. </li>
        <li> <keyword> Don't use this! </keyword></li>
    </ul></li>

    <li style="padding-bottom: 20px"> CROSS JOIN <ul>
        <li> Default without any selection. </li>
        <li> Gives every <keyword>permutation</keyword> of rows in each table. </li>
    </ul></li>
</ul>
<p><em>* might be useful to know.</em></p>

<p> Another notation would be </p> <pre><code>USING (field)</code></pre> <p> instead of </p> <pre><code>ON TableA.field=TableB.field</code></pre>

<h3 id="joins2"> 6.2 &ndash; Set Operations </h3>
<p> A Query can be formulated as <keyword>set operations</keyword> on two results. </p>
<ul>
    <li> UNION </li>
    <li> INTERSECT </li>
    <li> EXCEPT (set difference) </li>
</ul>
<img src="images/database/joins7.JPG"/>

<h3 id="joins3"> 6.3 &ndash; Subqueries </h3>
<p> <keyword>Subqueries</keyword> may be used in the result of the <keyword>outer query</keyword>. </p>
<p> There are many operators that can be used with the sub-result: </p>
<ul>
    <li> [NOT] IN </li>
    <li> [NOT] EXISTS </li>
    <li> [operation] ANY </li>
    <li> [operation] ALL </li>
</ul>
<p> We can <keyword>reference</keyword> the <strong>outer row</strong> within the nested query by using its <a href="#name">names</a> we created for the tables. </p>
<pre>
    SELECT S1.id FROM Student S1
    WHERE S1.dob > ALL
        ( SELECT S2.dob FROM Student S2
          WHERE S2.course='CS' );
</pre>

<h3 id="joins4"> 6.4 &ndash; Groups </h3>
<p> <code>GROUP BY</code> and <code>HAVING</code> allows operation over <keyword>groups of rows</keyword>. </p>
<ul>
    <li> GROUP BY <ul>
        <li> Specifies <keyword>grouping</keyword> of rows. </li>
    </ul></li>

    <li> HAVING <ul>
        <li> Specifies <keyword>selection criteria</keyword> for groups. </li>
    </ul></li>

</ul>
<pre>
    SELECT customerName, SUM(orderQuantity)
    FROM Sales
    GROUP BY customerName
    HAVING SUM(orderQuantity > 5);
</pre>
<p> This <keyword>joins</keyword> the tables, then <keyword>filter</keyword> rows using WHERE clause if any, then <keyword>group</keyword> the table using the <strong>attributes</strong> specified in the GROUP BY clause, returning one row per group. Finally, it <keyword>removes</keyword> rows where the HAVING clause <strong>does not</strong> return TRUE. </p>

<p> <strong>Exercise</strong>: Return a table which lists each student registered on course 'CS' with their average mark over all modules: </p>
<ul>
    <li> Extend to only include students with average &ge; 70; </li>
    <li> and all marks &ge; 40. </li>
</ul>
<!--
<span onclick="this.innerHTML='<pre><code> ' +
  'SELECT name, AVG(marks) <br/> ' +
  'FROM Marks <br/> ' +
  'GROUP BY name <br/>' +
  ' marks > (SELECT AVG(marks) FROM Marks) ;</code></pre>'" style="border: 1px solid black;"> Click for answer </span>
-->

<h3 id="joins5"> 6.5 &ndash; Views </h3>
<p><keyword>Views</keyword> provide a mechanism whereby a user can be given an <keyword>alternative view</keyword> onto the underlying database. </p>
<p> A <em>view</em> is specified in terms of underlying tables. </p>
<ul>
    <li> <keyword>Derived Tables</keyword> &ndash; A table expression that appears in the FROM clause of a query. </li>
    <li> <keyword>Base Tables </keyword> &ndash; A table that contains just stored records. </li>
</ul>
<p> This is for <keyword>convenience</keyword> and <keyword>security</keyword>. </p>

<hr/> <!------------------------------------------------------------------------------->

<h2 id="jdbc"> 7 &ndash; Java Database Connection </h2>
<p> JDBC provides mechanism for <keyword>connection</keyword> to database systems. Interaction is in terms of <keyword>strings</keyword> and <keyword>resultsets</keyword>. </p>
<h3 id="jdbc1"> 7.1 &ndash; Using JDBC </h3>
<ol>
    <li> Setup JDBC </li>
    <li> Establish DB Connection - Can be slow at times </li>
    <li> Repeat <ul>
        <li> Execute Query </li>
        <li> Process Result </li>
    </ul> </li>
    <li> Close the connection </li>
</ol>

<h4> Set Up </h4>
<p> Packages </p>
<pre>
    import java.sql.*;
    import javax.sql.*;
</pre>
<p> Drivers </p>
<pre>
    System.setProperty("jdbc.drivers","org.postgresql.Driver")
</pre>

<h4> Connect </h4>
<p> Define location of server </p>
<pre>
    String dbName = "jdbc:postgresql://mod-intro-databases/&lt;dbname&gt;";
</pre>

<p> Establish connection </p>
<pre>
    Connection dbConn = null;
    try {
        Connection dbConn = DriverManager.getConnection(dbName, &lt;User&gt;, &lt;Password&gt;);

        ...

    } catch (SQLException e) {
        e.printStackTrace();
    } finally {
        dbConn.close();
    }
</pre>
<img src="images/database/jdbc1.JPG"/>

<h4> Executing Statements </h4>
<p>To execute a statement we need: </p>
<ul>
    <li> <em>Statement</em> object - Query is specified <keyword>when executed</keyword> </li>
    <li> <em>PreparedStatement</em> object - Query is specified <keyword>when object is created</keyword> </li>
    <li> <code>execute(String)</code> - Execute any SQL statement </li>
    <li> <code>executeUpdate(String)</code> - For INSERT, UPDATE, DELETE, etc. </li>
    <li> <code>executeQuery(String)</code> - For Query </li>
</ul>

<pre>
    Statement stmt = dbConn.createStatement();

    <span style="color: #9e9e9e;">// executeUpdate example</span>
    String update = "INSERT INTO Students VALUES (1, 'John Doe')";
    stmt.executeUpdate(update);

    <span style="color: #9e9e9e;">// executeQuery example</span>
    String query = "SELECT * FROM Students";
    ResultSet r = stmt.executeQuery(query);
    while (r.next()) {
        <span style="color: #9e9e9e;">// Access field using position or name</span>
        id = r.getInt(1); <span style="color: #9e9e9e;">// position starts from 1</span>
        id = r.getInt("id");
    }

    <span style="color: #9e9e9e;">// PreparedStatement example</span>
    PreparedStatement stmt2 = dbConn.prepareStatement(query); <span style="color: #9e9e9e;">// same thing, but SQL statement defined in constructor</span>
    ResultSet r2 = stmt2.executeQuery();
    while (r2.next()) { ... }
</pre>

<p> <em>PreparedStatements</em> are safe from <keyword>SQL Injection</keyword> because SQL statements are already prepared. If statements have to take user input, then there is no guarantee the user isn't going to DROP TABLES. </p>

<h4> About ResultSets </h4>
<p> The default ResultSets only allows forward movement though a static table. This may be inconvenient. </p>
<p> So hence there are other ResultSets that will solve this issue. </p>
<ul>
    <li> <strong>Scrollable</strong> <ul>
        <li> Move to any position </li>
    </ul></li>

    <li> <strong>Updateable</strong> <ul>
        <li> Modify ResultSet and write changes back to DB. </li>
    </ul></li>

    <li> <strong>Dynamic</strong> <ul>
        <li> Have ResultSet updated to reflect changes in DB. </li>
    </ul></li>

    <li> <strong>CachedRowSets</strong> <ul>
        <li> Allows work offline. </li>
    </ul></li>
</ul>

<h4> SQLException </h4>
<p> Errors should be caught and handled appropriately. Should have multiple <keyword>catch</keyword> clauses for different exception classes. </p>

<h4> Close </h4>
<p> <em>ResultSets</em>, <em>Statements</em> and <em>Connections</em> should be <keyword>closed</keyword> when no longer needed. </p>
<ul>
    <li> Closing a <keyword>connection</keyword> closes <strong>all</strong> its <strong>statements</strong>. </li>
    <li> Closing a <keyword>statement</keyword> closes <strong>all</strong> its <strong>resultSets</strong>. </li>
</ul>

<h3 id="jdbc2"> 7.2 &ndash; Transactions </h3>
<p> Compound operations which <strong>must</strong> be performed in their entirety. Must maintain <a href="#database">ACID</a> </p>
<p> E.g. Moving money from one account to another. </p>

<h4> Importance of Transactions </h4>
<p> This allows <keyword>concurrent access across multiple applications</keyword> and still <keyword>maintain correct behaviour</keyword>. It also is <keyword>robust against failure</keyword>. </p>

<p> Transaction typically maintains it's <keyword>own copy</keyword> of the database. </p>
<ul>
    <li> If the transaction is <strong>successful</strong> <ul>
        <li> <keyword>Commit the changes</keyword> in the permanent database. </li>
    </ul></li>
    
    <li> If not <ul>
        <li> <keyword>Changes are rolled back</keyword>. </li>
        <li> This may be because of explicit or implicit <strong>failure</strong>, <strong>conflicts</strong> with other transactions or <strong>deadlock detection</strong>. </li>
    </ul></li>
</ul>

<h4> Performance </h4>
<p> Handling of transactions is divided as </p>
<ul>
    <li> <keyword>Optimistic</keyword> <ul>
        <li> Assume no problems is we <strong>detect and fix</strong> it. </li>
    </ul></li>
    <li> <keyword>Pessimistic</keyword> <ul>
        <li> Assume there is a likely conflict so we <strong>prevent it</strong>. </li>
    </ul></li>
</ul>

<p> Transactions provide an <keyword>abstraction</keyword> from how the DBMS implement correct behaviour. </p>

<hr/> <!------------------------------------------------------------------------------->

<h2 id="design"> 8 &ndash; Database Design </h2>
<h4> Background </h4>
<p> DB are part of many information systems. It is necessary to describe databases as part of <keyword>design process</keyword>, to <keyword>document</keyword> an existing system, and as part of the <keyword>modification and extension</keyword> of existing systems. </p>
<p> E.g. Requirements Analysis, Design, Coding, Testing, Maintenance, Documentation, Project Management. </p>

<ul>
    <li><strong>Methodologies</strong><ul>
        <li> Approaches to the task of analysing the problem, creating solutions and testing the result. </li>
        <li> Usually include some heuristics and metrics. </li>
    </ul></li>

    <li><strong>Notations</strong><ul>
        <li> Means of describing the problem, solution, and process. </li>
        <li> Also provide means to record and communicate. </li>
    </ul></li>
</ul>

<h3 id="design1"> 8.1 &ndash; Design with Entity Relationship (ER) </h3>
<p> DB is usually part of some larger system. To capture data requirements, constraints, etc. </p>
<h4> Entity Relationship </h4>
<p> A standard way to describe the <em>conceptual</em> structure of a database. </p>
<p> Can be easily <keyword>mapped</keyword> to DB schema. May be partitioned for large complex designs. </p>

<h4> Components of ER </h4>
<ul>
    <li><keyword>Oval</keyword> - Attributes</li>
    <li><keyword>Rectangle</keyword> - Entity Set<ul>
        <li> Double outlined boxes show <strong>weak</strong> entity set</li>
    </ul></li>
    <li><keyword>Diamond</keyword> - Relation Set</li>
    <li><keyword>Lines</keyword> - Links<ul>
        <li>Labels on line indicate role</li>
    </ul></li>
    <li> Cardinality </li>
</ul>
<img width="400" src="images/database/design1.JPG"/>

<h4> Attributes and Entity </h4>
<p> Attributes drawn in <keyword>ovals</keyword>. </p>
<ul>
    <li> Primary Key - <keyword>underlined</keyword> </li>
    <li> Composite attributes e.g. address </li>
    <li> Derived attributes e.g. age - <keyword>dashed oval</keyword></li>
    <li> Multivalued - <keyword>double outline oval</keyword></li>
</ul>
<p> Entity drawn in <keyword>rectangles</keyword>. </p>
<img src="images/database/design2.JPG"/>

<h4> Relationships </h4>
<p> Association between entities. </p>
<ul>
    <li> Names inside <keyword>diamond</keyword> </li>
    <li> <keyword>Lines</keyword> can be labelled to define roles and can link to: <ul>
        <li> Entity sets </li>
        <li> Attributes </li>
        <li> Relations </li>
    </ul></li>
</ul>

<h4> Cardinality Restrictions </h4>
<p> We can define <keyword>constraints</keyword> on the <keyword>participation</keyword> of entities in a relation. </p>
<ul>
    <li> Minimum - 0 or 1 </li>
    <li> Maximum - 1 or many </li>
</ul>
<p> There are many ways to represent cardinality, but we will only use one here. </p>
<img src="images/database/design3.JPG"/>
<p> In this way, we specify the <keyword>minimum</keyword> and <keyword>maximum participation</keyword> in brackets. </p>
<ul></ul>

<h4> Weak Entity Set </h4>
<p> A set where the entities cannot be distinguished - there is no key. They can only be identified uniquely in the context of an <em>owner</em>. </p>
<p> Drawn using <keyword>double lined</keyword> boxes. </p>
<p> E.g. Dependents of an employee. Emergency contacts for a student. </p>

<h3 id="design2"> 8.2 &ndash; Mapping from ER to DB </h3>
<p> The design is mapped to <strong>Tables</strong> and <strong>Constraints</strong>. </p>
<p> Mappings: </p>
<ul>
    <li style="padding-bottom: 10px"><strong>Entity Set</strong> &equiv; <keyword>Tables</keyword><ul>
        <li> Table name </li>
        <li> Attributes </li>
        <li> Primary Key </li>
    </ul></li>

    <li style="padding-bottom: 10px"><strong>Weak Entity Sets</strong> &equiv; <keyword>Tables</keyword><ul>
        <li> Include the <keyword>key of the <em>owner</em></keyword> entity. </li>
        <li> <keyword>Cannot exist without the <em>owner</em></keyword>, so bind <code>ON DELETE CASCADE</code>. </li>
    </ul></li>

    <li style="padding-bottom: 10px"><strong>Relationship Sets</strong> &equiv; <keyword>Tables</keyword> but avoid where possible<ul>
        <li style="padding-bottom: 7px"> 1 : 1 - Add key of <keyword>one entity</keyword> as <strong>foreign key</strong> of other. Move attributes of the relationship to that entity. </li>
        <li style="padding-bottom: 7px"> 1 : N - Add key of <keyword>N side entity</keyword> as <strong>foreign key</strong> of the other. Move attributes of the relationship to that entity. </li>
        <li style="padding-bottom: 7px"> M : N - Add <keyword>new relation</keyword> containing the keys of the participating entities as <strong>foreign keys</strong> and the attributes of the relationship. The key of the new relation is the <strong>combination</strong> of the foreign keys. </li>
        <li style="padding-bottom: 7px"> N-ary - For each relationship, do as M : N relationship. The key is all <strong>foreign keys</strong>. </li>
        <li style="padding-bottom: 7px"> Multi-valued attributes - Add <keyword>new table</keyword> containing an attribute representing the attribute itself, and containing the entity's primary key as a <strong>foreign key</strong>. The key is the foreign key and one or more of the attributes. </li>
    </ul></li>
</ul>

<hr/> <!------------------------------------------------------------------------------->

<h2 id="webapps"> 9 &ndash; Web Applications </h2>

<hr/> <!------------------------------------------------------------------------------->

<h2 id="papers"> Exam Paper </h2>
<blockquote>
    It's a new course so there are no past papers.
    There is an example paper on the module web page.
    <cite>-Bob</cite>
</blockquote>

<p> <a href="http://www.cs.bham.ac.uk/~rjh/courses/IntroToDBs/2016-17/Example%20Paper.pdf">Example Paper</a> </p>
<h4> Click each boxes to reveal answers for Example Paper </h4>
<ul>
    <li style="padding-bottom: 10px;"> Q1 a) <span style="border: dotted 1px" title="Click to reveal answer" onclick="this.innerHTML='<pre>SELECT city, sum(duration) FROM Calls\nJOIN Subscribers ON Calls.caller=Subscribers.phoneno\nGROUP BY City;</pre>'; this.style.border='none'"> Show </span></li>

    <li style="padding-bottom: 10px;"> Q1 b) <span style="border: dotted 1px" title="Click to reveal answer" onclick="this.innerHTML='<pre>SELECT name FROM Subscribers\nJOIN Calls C1 ON C1.receiver=Subscribers.phoneno\nJOIN Calls C2 ON C2.caller=Subscribers.phoneno\nWHERE C1.duration >= 600 OR C2.duration >= 600\nGROUP BY name;</pre>'; this.style.border='none'"> Show </span></li>

    <li style="padding-bottom: 10px;"> Q1 c) <span style="border: dotted 1px" title="Click to reveal answer" onclick="this.innerHTML='<pre>' +
     'SELECT name FROM Subscribers\nJOIN Calls ON receiver=Subscribers.phoneno\nWHERE city=London\nGROUP BY name\nORDER BY name;</pre>'; this.style.border='none'"> Show </span></li>

    <li style="padding-bottom: 10px;"> Q1 d) <span style="border: dotted 1px" title="Click to reveal answer" onclick="this.innerHTML='<pre>SELECT name, sum(duration) FROM Subscribers\nJOIN Calls ON caller=phoneno\nGROUP BY name HAVING sum(duration) > 500;</pre>'; this.style.border='none'"> Show </span></li>

    <li style="padding-bottom: 10px;"> Q6 <span style="border: dotted 1px" title="Click to reveal answer" onclick="this.innerHTML='<pre>CREATE TABLE Member (memberid INT, name VARCHAR, address VARCHAR, age INT, sex VARCHAR(1), homebranch INT, PRIMARY KEY (memberid), FOREIGN KEY (homebranch) REFERENCES Branch(branchid)); <br/>CREATE TABLE Branch (branchid INT, branchname VARCHAR,branchcity VARCHAR, PRIMARY KEY (branchid)); <br/>CREATE TABLE Visit (memberid INT, branchid INT, FOREIGN KEY memberid REFERENCES Member(memberid), FOREIGN KEY branchid REFERENCES Branch(branchid));</pre>'; this.style.border='none'"> Show </span></li>
</ul>

<hr/> <!------------------------------------------------------------------------------->

<!-- Utils -->
<button onclick="topFunction()" id="topBtn" title="Go to top">Top</button>
<script>
    // When the user scrolls down 20px from the top of the document, show the button
    window.onscroll = function () {
        scrollFunction()
    };

    function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            document.getElementById("topBtn").style.display = "block";
        } else {
            document.getElementById("topBtn").style.display = "none";
        }
    }

    // When the user clicks on the button, scroll to the top of the document
    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }
</script>
<button onclick="window.location.href='index.html'" id="homeBtn" title="Back to Home"> Home</button>
</body>
</html>
